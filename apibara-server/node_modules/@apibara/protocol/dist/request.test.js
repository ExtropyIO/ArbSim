"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const proto_1 = require("./proto");
const testing_1 = require("./proto/testing");
const request_1 = require("./request");
describe("RequestBuilder", () => {
    it("returns the final request", () => {
        const filter = new testing_1.TestFilter();
        filter.num = 123;
        filter.text = "abcdef";
        const request = request_1.StreamDataRequest.create()
            .withBatchSize(10)
            .withFilter(testing_1.TestFilter.encode(filter).finish())
            .withFinality(proto_1.v1alpha2.DataFinality.DATA_STATUS_FINALIZED)
            .encode();
        expect(request.batchSize).toEqual(10);
        expect(request.filter).toBeInstanceOf(Buffer);
        expect(request.filter?.length).toEqual(10);
        // make ts happy
        if (!request.filter || typeof request.filter === "string") {
            throw new Error("undefined filter");
        }
        const back = testing_1.TestFilter.decode(request.filter);
        expect(back.num.toString()).toEqual("123");
        expect(back.text).toEqual("abcdef");
    });
});
//# sourceMappingURL=request.test.js.map